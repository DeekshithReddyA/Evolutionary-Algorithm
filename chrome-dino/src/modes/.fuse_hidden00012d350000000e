// ── User play mode ───────────────────────────
import { Dino } from '../dino.js';

export class UserMode {
  constructor(engine) {
    this.engine      = engine;
    this.dino        = null;
    this._keyHandler = null;
  }

  start() {
    this.dino = new Dino();
    this.engine.setDinos([this.dino]);

    this.engine.onAllDead = () => {
      const btn = document.getElementById('startStopBtn');
      if (btn) btn.textContent = 'Restart';
    };

    this.engine.onUpdate = ({ score, speed }) => {
      const el = document.getElementById('currentScore');
      if (el) el.textContent = score;
      const sp = document.getElementById('currentSpeed');
      if (sp) sp.textContent = speed.toFixed(1);
    };

    this._bindKeyboard();
    this.engine.start();
  }

  _bindKeyboard() {
    this._keyHandler = (e) => {
      if (e.code === 'Space' || e.code === 'ArrowUp') {
        e.preventDefault();
        if (this.dino && this.engine.running) this.dino.jump();
      }
    };
    window.addEventListener('keydown', this._keyHandler);
  }

  stop()    { this.engine.stop(); }
  cleanup() {
    this.stop();
    if (this._keyHandler) {
      window.removeEventListener('keydown', this._keyHandler);
      this._keyHandler = null;
    }
  }
  getTracker() { return null; }   // no analytics in user mode
}
